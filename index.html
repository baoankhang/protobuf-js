<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset =UTF-8"></meta>
  <title>protobuf-js</title>
  <style>
    #container { width:280px; text-align:center; }
    #target { width:50px; }
    #decode-button { margin:5px; }
    #result { border:1px solid black; width:250px; height:150px; padding:10px; text-align:left; }
  </style>
  <script src="lib/prototype.js"></script>
  <script src="javascripts/protobuf.js"></script>
  <script>
  var description = {
    1: {name: 'name',  type: 'string', rule: 'required'},
    2: {name: 'id',    type: 'int32',  rule: 'required'},
    3: {name: 'email', type: 'string', rule: 'optional'},
    PhoneNumber: {
      1: {name: 'number', type: 'string', rule: 'required'},
      2: {name: 'type', type: 'int32', rule: 'optional'},
    },
    4: {name: 'phone', type: 'PhoneNumber', rule: 'optional'},
  };
  function inspect(obj, indentLevel) {
    if (!indentLevel) indentLevel = 0;
    var indent = '';
    for (var i = 0; i < indentLevel; i++) indent += '  ';

    var ret = '';
    for (var key in obj) {
      var val = obj[key];
      ret += indent + key + ':'; 
      if (typeof(val) == 'object') {
        ret += "\n" + inspect(val, indentLevel + 1) + "\n";
      }
      else {
        ret += val + "\n";
      }
    }
    return ret;
  }
  function getIndent(indentLevel) {
    var ret = '';
    for (var i = 0; i < indentLevel; i++) ret += '  ';
    return ret;
  }
  function testDecoder(file) {
    var url = '/data/' + file + '.bin';
    $('result').innerHTML = inspect(new Protobuf.Decoder(description).decodeUrl(url));
  }
  </script>
</head>
<body>
  <div id="container">
    <div>
      <button onclick="testDecoder($('target').value)">Decode!</button>
      Source: /data/
      <select id="target" style="width:60px;"> 
        <option value="simple">simple</option>
        <option value="embed">embed</option>
      </select>
      .bin
    </div>
    <pre id="result"></pre>
    <button onclick="$('result').innerHTML = ''">Clear!</button>
  </div>
</body>
</html>
